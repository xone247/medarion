# Setup API on Port 5000 with Cloudflare Tunnel
# Run these commands in Jupyter Terminal

# 1. Kill any old API process
pkill -f 'python3.*run_api_on_vast.py'

# 2. Wait a moment
sleep 2

# 3. Start API on port 5000
cd /workspace && nohup python3 run_api_on_vast.py > api.log 2>&1 &

# 4. Wait for model to load (30-60 seconds)
sleep 30

# 5. Verify API is running
ps aux | grep 'python3.*run_api_on_vast.py' | grep -v grep

# 6. Test internal endpoint
curl http://localhost:5000/health

# Expected: {"status":"ok","model":"Mistral-7B"}

# 7. Create Cloudflare tunnel for port 5000
# Option A: Via Vast.ai Dashboard
#   - Go to Tunnels section
#   - Create New Tunnel
#   - Enter: localhost:5000
#   - Copy the URL

# Option B: Via Command Line
nohup cloudflared tunnel --url http://localhost:5000 > /tmp/api_tunnel_5000.log 2>&1 &

# Wait and get URL
sleep 3
cat /tmp/api_tunnel_5000.log | grep trycloudflare

# 8. Test public tunnel URL (from your PC)
# curl https://your-new-tunnel-url.trycloudflare.com/health

